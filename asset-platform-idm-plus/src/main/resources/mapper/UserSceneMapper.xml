<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.asset.mapper.UserSceneMapper">
    <select id="hasScene" resultType="com.asset.bean.UserScene">
        select * from as_user_scene where user_id = #{param1} and scene_id = #{param2} and status =1
    </select>
    <update id="updateByUserAndScene">
        update as_user_scene set status = 1 where user_id = #{param1} and scene_id = #{param2} and status = 0
    </update>
    <update id="updateNodeIdByUserId">
        UPDATE as_user_scene SET node_id = #{param3} WHERE status = 1 AND user_id = #{param1} AND scene_id = #{param2}
    </update>
    <select id="getUser4Principal" resultType="com.asset.bean.UserScene">
        SELECT * FROM as_user_scene WHERE status = 1 AND user_id = #{param1} AND scene_id = #{param2} AND node_id = #{param3}
    </select>
    <update id="cancelPrincipal">
        UPDATE as_user_scene SET node_principal = 0
        WHERE scene_id = #{param1} AND node_id = #{param2} AND status = 1 AND node_principal = 1
    </update>
    <select id="getUsers" resultType="com.asset.bean.User">
        select account_name, id, real_name, account_name, user_email, phone_number, account_picture, user_address, status
        from as_user
        where as_user.id IN (
            SELECT user_id from as_user_scene WHERE scene_id = #{param1} AND node_id = #{param2} AND status = 1
        )
        AND real_name LIKE CONCAT('%',#{param3},'%')
    </select>
    <select id="getRoles" resultType="com.asset.bean.SceneRole">
        SELECT * FROM as_scene_role WHERE scene_code = #{param2} AND is_deleted = 0 AND id IN (
            SELECT role_id FROM as_user_scene us WHERE us.user_id = #{param1} AND us.scene_id = #{param2} AND status = 1
        )
    </select>
</mapper>
